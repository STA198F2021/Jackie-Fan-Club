---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM"
author: "Ashley Bae, Gi Chun, Jay Nolt"
date: "November 2021"
output: pdf_document
---

# Load Packages
```{r load-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(tidymodels)
library(readxl)
library(dbplyr)
library(ggplot2)
``` 

# Load Data 
```{r load-data}
load(file = "~/sta198/Jackie-Fan-Club/data/ICPSR_34363/DS0001/34363-0001-Data.rda")
#rename file
data <- da34363.0001
```
Data Citation: Battle, Juan, Pastrana, Antonio Jay, and Daniels, Jessie. Social Justice Sexuality Project: 2010 National Survey, including Puerto Rico. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2013-08-09. https://doi.org/10.3886/ICPSR34363.v1

```{r select-data, echo = FALSE}
data_filtered <- data %>%
  select(Q15B,
         Q15C,
         Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25)
# remove descriptions and other attributes
data_filtered2 <- lapply(data, function(x) {attributes(x) <- NULL; x}) %>% 
  as.data.frame() %>%
  select(Q15B,
         Q15C,
         Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25)
```

```{r renameQuestions, echo = FALSE}
data_big <- data_filtered %>%
    select(Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25) %>%
  rename(healthInsureAcc = Q17A) %>%
  rename(healthProvideAcc = Q17B) %>%
  rename(male = Q18A1) %>%
  rename(female = Q18A2) %>% 
  rename(m2f = Q18A3) %>%
  rename(f2m = Q18A4) %>%
  rename(genderOther = Q18A5) %>%
  rename(sexuality = Q18C) %>%
  mutate(age = 2021 - Q18G) %>%
  rename(black = Q19A1) %>%
  rename(hispanic = Q19A2) %>% 
  rename(asian = Q19A3) %>%
  rename(native = Q19A4) %>%
  rename(white = Q19A5) %>%
  rename(multi = Q19A6) %>%
  rename(raceOther = Q19A7) %>%
  rename(edu = Q22A) %>%
  rename(income = Q22B) %>%
  rename(assessHealth = Q25)
```

```{r creatingGender, echo = FALSE}
data <- data_big %>%
  mutate(male = case_when(
  male == "(1) Yes" ~ "male",
  is.na(male) ~ "",
  TRUE ~ ""), 
  female = case_when(
  female == "(1) Yes" ~ "female",
  is.na(female) ~ "",
  TRUE ~ ""), 
  m2f = case_when(
  m2f == "(1) Yes" ~ "m2f",
  is.na(m2f) ~ "",
  TRUE ~ ""), 
  f2m = case_when(
  f2m == "(1) Yes" ~ "f2m",
  is.na(f2m) ~ "",
  TRUE ~ ""), 
  genderOther = case_when(
  genderOther == "(1) Yes" ~ "Other",
  is.na(genderOther) ~ "",
  TRUE ~ ""), 
  gender = ""
) 
data$gender <- paste(data$male, data$female)
data$gender <- paste(data$gender, data$m2f)
data$gender <- paste(data$gender, data$f2m)
data$gender <- paste(data$gender, data$genderOther)
data$gender <- trimws(data$gender)
data <- data %>%
mutate(gender = case_when(
  gender == "male" ~ "Male",
  gender == "female" ~ "Female",
  gender == "m2f" ~ "Transgender: Male to Female",
  gender == "f2m" ~ "Transgender: Female to Male",
  TRUE ~ "Other")
)
```

```{r creatingRace, echo = FALSE}
data <- data %>%
  mutate(black = case_when(
  black == "(1) Yes" ~ "black",
  is.na(male) ~ "",
  TRUE ~ ""), 
  hispanic = case_when(
  hispanic == "(1) Yes" ~ "hispanic",
  is.na(hispanic) ~ "",
  TRUE ~ ""), 
  asian = case_when(
  asian == "(1) Yes" ~ "asian",
  is.na(asian) ~ "",
  TRUE ~ ""), 
  native = case_when(
  native == "(1) Yes" ~ "native",
  is.na(native) ~ "",
  TRUE ~ ""), 
  white = case_when(
  white == "(1) Yes" ~ "white",
  is.na(white) ~ "",
  TRUE ~ ""), 
  multi = case_when(
  multi == "(1) Yes" ~ "multi",
  is.na(multi) ~ "",
  TRUE ~ ""), 
  raceOther = case_when(
  raceOther == "(1) Yes" ~ "Other",
  is.na(raceOther) ~ "",
  TRUE ~ ""), 
  race = ""
) 
data$race <- paste(data$black, data$hispanic)
data$race <- paste(data$race, data$asian)
data$race <- paste(data$race, data$native)
data$race <- paste(data$race, data$white)
data$race <- paste(data$race, data$multi)
data$race <- paste(data$race, data$raceOther)
data$race <- trimws(data$race)
data <- data %>%
mutate(race = case_when(
  race == "black" ~ "Black",
  race == "hispanic" ~ "Hispanic",
  race == "asian" ~ "Asian",
  race == "native" ~ "Native",
  race == "white" ~ "White",
  race == "multi" ~ "Multiracial",
  race == "other" ~ "Other",
  race == "" ~ "Other",
  TRUE ~ "Multiracial")
)
```


```{r gender-barplot}
ggplot(data, aes(x = gender)) +
  geom_bar(fill = "light blue") +
  labs (x = "Gender",
        y = "Frequency",
        title = "Distribution of Respondant Gender") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```
We visualized gender identities of participants with a pie chart. The biggest group of respondents are male, followed by female, followed by "other." There are more M2F transgender individuals than F2M transgender individuals captured in this study. 

```{r health-insurance-sexuality}
data %>% 
  filter(!is.na(healthInsureAcc), 
         !is.na(sexuality) 
         ) %>%
  ggplot(aes(x = sexuality,
           fill = healthInsureAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Insurance Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```

We used a segmented bar graph to visualize sexuality of respondents and their access to healthcare. The differences are not so visually distinct, especially when attempting to compare straight/heterosexual individuals to other historically and presently marginalized sexual identities. This is especially so in groups with many NA responses. In addition, the multitude of identities of sexuality which also may overlap or have culturally distinct attributes may complicate data analysis. The respondants are also prompted to choose only one identity, to the question "Which one label comes closest to how you describe your sexual identity?" 

In the second visualization of sexuality and access to healthcare, we visualized the with NA values removed. This helps us more clearly visualize the data. We can see more clearly that the group with least health insurance access is those identifying as macha/o. 

```{r health-provider-sexuality}
data %>%
  filter(is.na(healthProvideAcc) == FALSE) %>% 
ggplot(aes(x = sexuality,
                         fill = healthProvideAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Provider Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```


```{r health-insurance-gender}
data %>%
  filter(is.na(healthInsureAcc) == FALSE) %>% 
  ggplot(aes(x = gender,
          fill = healthInsureAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Gender",
        y = "Frequency",
        fill = "Healthcare Insurance Access",
        title = "Relationship of Gender and Healthcare Insurance Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```


```{r health-provider-gender}
data %>%
filter(is.na(healthProvideAcc) == FALSE) %>% 
ggplot(aes(x = gender,
                         fill = healthProvideAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Gender",
        y = "Frequency",
        fill = "Healthcare Provider Access",
        title = "Relationship of Gender and Healthcare Provider Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) 
```

In the above segmented bar graphs, respondents respond to "Do you have health insurance?" and "Do you have a regular doctor or health care provider?", respectively. The visualizations show that a greater percentage of transgender individuals answered "no" than cisgender individuals. The greatest percentage of "no" responses came from the group of F2M tansgender individuals. Also, when comparing the gender groups, note that there are more missing values for transgendered individuals than cisgendered respondents for both access to insurance and regular healthcare provider, which may provide more insight to the disparity. It appears that one's gender identity may have a relationship to access to healthcare. 

# Data Analysis 

To evaluate statistically significant impacts on health outcomes due to sexuality, gender, race, and intersectional identities, we ran a few statistical tests. 

```{r preliminary-regression, echo = FALSE, message = FALSE, warning = FALSE} 
data_fit <- data %>% 
mutate(sexuality_queer = if_else(sexuality == "(08) Straight/Heterosexual", "0", "1"),
       gender_trans = if_else((gender == "Male") | (gender == "Female"), "0", "1"), 
       WHITE = if_else(white == "(1) Yes", 1, 0),
       BLACK = if_else(black == "(1) Yes", 1, 0),
       HISPANIC = if_else(hispanic == "(1) Yes", 1, 0),
       ASIAN = if_else(asian == "(1) Yes", 1, 0),
       NATIVE = if_else(native == "(1) Yes", 1, 0),
       MULTIRACE = if_else(multi == "(1) Yes", 1, 0), 
       RACEOTHER = if_else(raceOther == "(1) Yes", 1, 0)) 

data_relevel <- data_fit
data_relevel$gender_trans = relevel(as.factor(data_relevel$gender_trans), ref = "0") 
data_relevel$race = relevel(as.factor(data_relevel$race), ref = "White") 
data_relevel$sexuality_queer = relevel(as.factor(data_relevel$sexuality_queer), ref = "0") 

# insurance fit ---------------------------------------------------------------------
insurancefit <- glm(healthInsureAcc ~ race + gender_trans + sexuality_queer,
           data = data_relevel, family = "binomial")
summary(insurancefit, conf.int = TRUE, exponentiate = TRUE)
# access fit ---------------------------------------------------------------------
providerfit <- glm(healthProvideAcc ~ race + gender_trans + sexuality_queer,
           data = data_relevel, family = "binomial")
summary(providerfit, conf.int = TRUE, exponentiate = TRUE)


# insurance fit interactions  ---------------------------------------------------------------------
insurancefit_interact <- glm(healthInsureAcc ~ race*gender_trans + gender_trans*sexuality_queer + sexuality_queer*race,
           data = data_relevel, family = "binomial")
summary(insurancefit_interact, conf.int = TRUE, exponentiate = TRUE)

# access fit interactions  ---------------------------------------------------------------------
providerfit_interact <- glm(healthProvideAcc ~ race*gender_trans + gender_trans*sexuality_queer + sexuality_queer*race,
           data = data_relevel, family = "binomial")
summary(providerfit_interact, conf.int = TRUE, exponentiate = TRUE)

# ANOVA for better fit -------------------------------------------
insurance_anova <- anova(insurancefit, insurancefit_interact, test = "LRT") 
summary(insurance_anova)

provider_anova <- anova(providerfit, providerfit_interact, test = "LRT") 
summary(provider_anova)
```
We ran a multiple regression for each health insurance access and health provider access conditional on gender, race, and sexuality. We saw that our referent group of white, cis, heterosexual individuals are 1.47 as likely to have health insurance than non-white, trans, non-heterosexual counterparts and 1.32 times as likely for access to a regular healthcare provider.

Sexuality is a complicated variable to work with, given that the question posed in the survey offers 12 options that are not all mutually exclusive, yet the answer given must be only one of the above. Also, to retain all options given would overcomplicate and weaken the model. Therefore, we decided to distinguish between heterosexual and all other sexuality answers in our subsequent models. 

In healthcare access, we found that the most negatively affected race group was Hispanic and the most negatively affected gender group was transgender individuals.  

We conducted another multiple regression with interaction terms, in order to evaluate intersection of gender and race groups. 

```{r overall-anova}
summary(aov(Q18C~Q25,data=data_filtered2))
```

```{r stepdown-anova}
sexpair <- pairwise.t.test(data_filtered2$Q18C,data_filtered2$Q25, p.adj = "holm")
sigpairs <- broom::tidy(sexpair) %>%
  filter(p.value<0.05) %>%
  arrange(group1,group2)
nrow(sigpairs)
print(sigpairs) 

```
4: 2-spirit
5: queer

Statistically, 2-spirit and queer are different from the rest 

