---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM"
author: "Jackie Fan Club: Ashley Bae, Gi Chun, Jay Nolt"
date: "November 2021"
output: pdf_document
---

# Load Packages
```{r load-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(tidymodels)
library(readxl)
library(dbplyr)
library(ggplot2)
``` 

# Load Data 
```{r load-data, message = FALSE}
load(file = "~/sta198/Jackie-Fan-Club/data/ICPSR_34363/DS0001/34363-0001-Data.rda")
#rename file
data <- da34363.0001
```
Data Citation: Battle, Juan, Pastrana, Antonio Jay, and Daniels, Jessie. Social Justice Sexuality Project: 2010 National Survey, including Puerto Rico. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2013-08-09. https://doi.org/10.3886/ICPSR34363.v1

```{r select-data}
data_filtered <- data %>%
  select(Q15B,
         Q15C,
         Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25)

# remove descriptions and other attributes
data_filtered2 <- lapply(data, function(x) {attributes(x) <- NULL; x}) %>% 
  as.data.frame() %>%
  select(Q15B,
         Q15C,
         Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25)
```

```{r renameQuestions}
data <- data_filtered %>%
    select(Q17A,
         Q17B,
         Q18A1:Q18A5,
         Q18C,
         Q18G,
         Q19A1:Q19A7,
         Q22A,
         Q22B,
         Q25) %>%
  rename(healthInsureAcc = Q17A) %>%
  rename(healthProvideAcc = Q17B) %>%
  rename(male = Q18A1) %>%
  rename(female = Q18A2) %>% 
  rename(m2f = Q18A3) %>%
  rename(f2m = Q18A4) %>%
  rename(genderOther = Q18A5) %>%
  rename(sexuality = Q18C) %>%
  mutate(age = 2021 - Q18G) %>%
  rename(black = Q19A1) %>%
  rename(hispanic = Q19A2) %>% 
  rename(asian = Q19A3) %>%
  rename(native = Q19A4) %>%
  rename(white = Q19A5) %>%
  rename(multi = Q19A6) %>%
  rename(raceOther = Q19A7) %>%
  rename(edu = Q22A) %>%
  rename(income = Q22B) %>%
  rename(assessHealth = Q25)
```

```{r creatingGender}
data <- data %>%
  mutate(male = case_when(
  male == "(1) Yes" ~ "male",
  is.na(male) ~ "",
  TRUE ~ ""), 
  female = case_when(
  female == "(1) Yes" ~ "female",
  is.na(female) ~ "",
  TRUE ~ ""), 
  m2f = case_when(
  m2f == "(1) Yes" ~ "m2f",
  is.na(m2f) ~ "",
  TRUE ~ ""), 
  f2m = case_when(
  f2m == "(1) Yes" ~ "f2m",
  is.na(f2m) ~ "",
  TRUE ~ ""), 
  genderOther = case_when(
  genderOther == "(1) Yes" ~ "Other",
  is.na(genderOther) ~ "",
  TRUE ~ ""), 
  gender = ""
) 

data$gender <- paste(data$male, data$female)
data$gender <- paste(data$gender, data$m2f)
data$gender <- paste(data$gender, data$f2m)
data$gender <- paste(data$gender, data$genderOther)

data$gender <- trimws(data$gender)

data <- data %>%
mutate(gender = case_when(
  gender == "male" ~ "Male",
  gender == "female" ~ "Female",
  gender == "m2f" ~ "Transgender: Male to Female",
  gender == "f2m" ~ "Transgender: Female to Male",
  TRUE ~ "Other")
)
```

```{r gender-barplot}
ggplot(data, aes(x = gender)) +
  geom_bar(fill = "light blue") +
  labs (x = "Gender",
        y = "Frequency",
        title = "Distribution of Respondant Gender") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```

We visualized gender identities of participants with a pie chart. The biggest group of respondents are male, followed by female, followed by "other." There are more M2F transgender individuals than F2M transgender individuals captured in this study. 

```{r health-insurance-sexuality}
ggplot(data, aes(x = sexuality,
                 fill = healthInsureAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Insurance Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
data %>% 
  filter(!is.na(healthInsureAcc), 
         !is.na(sexuality) 
         ) %>%
  ggplot(aes(x = sexuality,
           fill = healthInsureAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Insurance Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```

We used a segmented bar graph to visualize sexuality of respondents and their access to healthcare. The differences are not so visually distinct, especially when attempting to compare straight/heterosexual individuals to other historically and presently marginalized sexual identities. This is especially so in groups with many NA responses. In addition, the multitude of identities of sexuality which also may overlap or have culturally distinct attributes may complicate data analysis. The respondants are also prompted to choose only one identity, to the question "Which one label comes closest to how you describe your sexual identity?" 

In the included visualization of sexuality and access to healthcare, we visualized the with NA values removed. This helps us more clearly visualize the data. We can see more clearly that the group with least health insurance access is those identifying as macha/o. 

```{r health-provider-sexuality}
data %>%
ggplot(aes(x = sexuality,
                         fill = healthProvideAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Provider Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) 

data %>%
  filter(is.na(healthProvideAcc) == FALSE) %>% 
ggplot(aes(x = sexuality,
                         fill = healthProvideAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Sexuality",
        y = "Frequency",
        fill = "Healthcare Provider Access",
        title = "Distribution of Respondant Sexuality and Healthcare Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) 

table(data$sexuality, data$healthProvideAcc)
```


```{r health-insurance-gender}
data %>%
ggplot(aes(x = gender,
          fill = healthInsureAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Gender",
        y = "Frequency",
        fill = "Healthcare Insurance Access",
        title = "Relationship of Gender and Healthcare Insurance Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
```

```{r health-provider-gender}
ggplot(data, aes(x = gender,
                         fill = healthProvideAcc)) +
  geom_bar(position = "fill") +
  labs (x = "Gender",
        y = "Frequency",
        fill = "Healthcare Provider Access",
        title = "Relationship of Gender and Healthcare Provider Access") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) 
```
In the above segmented bar graphs, respondents respond to "Do you have health insurance?" and "Do you have a regular doctor or health care provider?", respectively. The visualizations show that a greater percentage of transgender individuals answered "no" than cisgender individuals. The greatest percentage of "no" responses came from the group of F2M tansgender individuals. Also, when comparing the gender groups, note that there are more missing values for transgendered individuals than cisgendered respondents for both access to insurance and regular healthcare provider, which may provide more insight to the disparity. It appears that one's gender identity may have a relationship to access to healthcare. 

# Data Analysis 

To evaluate impacts of intersectional identities on health outcomes, we ran a few statistical tests. 

Sexuality: strait/heterosexual vs queer (all other sexualities.. hard to distinguish)
Gender: cisgender vs transgender 
Race: keep each group 

```{r logistic-regression}
data_fit <- data %>%
  mutate(
    SEXUALITY = if_else(sexuality == "(08) Straight/Heterosexual", 0, 1),
    GENDER = if_else((gender == "Male") | (gender == "Female"), 0, 1),
    BLACK = if_else(black == "(1) Yes", 1, 0),
    HISPANIC = if_else(hispanic == "(1) Yes", 1, 0),
    ASIAN = if_else(asian == "(1) Yes", 1, 0),
    NATIVE = if_else(native == "(1) Yes", 1, 0),
    MULTIRACE = if_else(multi == "(1) Yes", 1, 0), 
    RACEOTHER = if_else(raceOther == "(1) Yes", 1, 0)
  )

# insurance_fit_multi <- logistic_reg() %>%
#   set_engine("glm") %>%
#   fit(
#     healthInsureAcc ~ SEXUALITY + GENDER + BLACK + HISPANIC + ASIAN + NATIVE + MULTIRACE + RACEOTHER,
#     data = data_fit,
#     family = "binomial"
#   )
# tidy(insurance_fit_multi,
#      conf.int = TRUE,
#      exponentiate = TRUE) 

insurance_fit_multi_select <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(
    healthInsureAcc ~ GENDER + BLACK + HISPANIC + ASIAN + NATIVE,
    data = data_fit,
    family = "binomial"
  )
tidy(insurance_fit_multi_select,
     conf.int = TRUE,
     exponentiate = TRUE) 

insurance_fit_multi_interact <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(
    healthInsureAcc ~ GENDER*BLACK + GENDER*HISPANIC + GENDER*ASIAN + GENDER*NATIVE,
    data = data_fit,
    family = "binomial"
  )
tidy(insurance_fit_multi_interact,
     conf.int = TRUE,
     exponentiate = TRUE)

```

We removed variables that are statistically insignificant when evaluating p values, which were sexuality (whether someone identified as straight/heterosexual or other sexualities), being multiracial, and being of "other" racial categories than options given on the survey. 

We conducted another multiple regression with interaction terms, in order to evaluate intersection of gender and race groups. 

```{r chi-sq, warning = FALSE}
observed_chisq_statistic <- data %>%
  specify(healthInsureAcc ~ sexuality) %>%
  calculate(stat = "Chisq") 

#fisher.test(data$healthInsureAcc,data$sexuality, simulate.p.value = TRUE) 
```
